var vicigoApp=angular.module("hashtag-app",["ui.router","ui.bootstrap","infinite-scroll","dcbImgFallback","xeditable","angular-inview","720kb.socialshare","ngDialog","angular.lazyimg","ViciAuth"]).constant("API_URL","").run(["ngDialog",function(e){!function(e,t,o){var a,i=e.getElementsByTagName(t)[0];e.getElementById(o)||(a=e.createElement(t),a.id=o,a.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(a,i))}(document,"script","facebook-jssdk"),function(e,t,o,a,i,s,n){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=t.createElement(o),n=t.getElementsByTagName(o)[0],s.async=1,s.src=a,n.parentNode.insertBefore(s,n)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-61717055-1","auto")}]).run(["$rootScope","$window","$location",function(e,t,o){t.fbAsyncInit=function(){FB.init({appId:"1577245229193798",status:!0,cookie:!0,xfbml:!0,version:"v2.4"})}}]).run(["$rootScope","$window","$location",function(e,t,o){e.$on("$stateChangeSuccess",function(e){t.ga("send","pageview",{page:o.url()})})}]).run(["ViciAuth","Uploader",function(e,t){t.init(),profilePicDropzone=new Dropzone("#profilePicDropzone",{url:"/upload/image?isProfileAvatar=true",maxFiles:10,maxfilesexceeded:function(e){this.removeAllFiles(),this.addFile(e)},thumbnailWidth:null,previewTemplate:document.querySelector("#preview-template").innerHTML}).on("sending",function(t,o){o.setRequestHeader("X-Auth-Token",e.getAuthToken())}).on("success",function(e,t){$("#uploadProfilePicModal").modal("hide"),document.getElementById("profilePic").src=t.link}),$(".tags-area").tagit({placeholderText:"tag it!"})}]).run(["$rootScope","$state","$timeout","$http",function(e,t,o,a){e.$on("notAuthenticated",function(){var e=["starter.welcome","vicigo.post","vicigo.postByAlias","vicigo.hashbook","vicigo.hashtag"];e.indexOf(t.current.name)==-1&&t.go("starter.welcome")})}]).run(["editableOptions",function(e){e.theme="bs3"}]).config(["$locationProvider","$urlMatcherFactoryProvider",function(e,t){e.html5Mode(!0),e.hashPrefix("!"),t.strictMode(!1)}]).config(["$httpProvider",function(e){"use strict";e.defaults.useXDomain=!0,e.interceptors.push("AuthInterceptor")}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("starter",{templateUrl:"/templates/layout.html",controller:"mainController"}).state("starter.welcome",{url:"/welcome",templateUrl:"/templates/welcome.html",controller:"welcomeController"}).state("starter.login",{url:"/login?code",templateUrl:"/templates/login.html",controller:"welcomeController"}).state("starter.signup",{url:"/signup",templateUrl:"/templates/welcome.html",controller:"welcomeController"}).state("vicigo",{abstract:!0,controller:"mainController",templateUrl:"/templates/layout.html"}).state("vicigo.feeds",{url:"/",templateUrl:"/templates/feeds.html",controller:"feedsController",resolve:{seo:["MetaService",function(e){return e.setDefault()}],checkLoggedIn:function(){return!0}}}).state("vicigo.importPhotos",{url:"/import",templateUrl:"/templates/import.html",controller:"importController"}).state("vicigo.chat",{url:"/chat/:userId",templateUrl:"/templates/chat.html",controller:"chatController"}).state("vicigo.notifs",{url:"/notifs",templateUrl:"/templates/notifs.html",controller:"notifsController",resolve:{notifs:["$stateParams","$http","MetaService",function(e,t,o){return t.get("/api/notifications?page=1&limit=30").then(function(e){return e.data})}]}}).state("vicigo.hashtag",{url:"/hashtag/:hashtag",templateUrl:"/templates/feeds.html",controller:"feedsController",resolve:{seo:["$stateParams","MetaService",function(e,t){return t.setForHashtag(e.hashtag)}]}}).state("vicigo.drafts",{url:"/drafts/",templateUrl:"/templates/drafts.html",controller:"draftsController"}).state("editor",{abstract:!0,templateUrl:"/templates/layout_write.html"}).state("editor.write",{url:"/write",templateUrl:"/templates/write.html"}).state("editor.edit",{url:"/edit/:postId",templateUrl:"/templates/write.html"}).state("vicigo.profile",{url:"/profile/:profileId",templateUrl:"/templates/profile.html",controller:"profileController",resolve:{profile:["$stateParams","$http","$q","ProfileService",function(e,t,o,a){var i=o.defer();return a.fetchProfile(e.profileId,function(e){i.resolve(e)}),i.promise}]}}).state("vicigo.post",{url:"/post/:postId",templateUrl:"/templates/post.html",controller:"postController",resolve:{post:["$stateParams","$http","$q","PostService",function(e,t,o,a){var i=o.defer();return a.getById(e.postId,function(e){i.resolve(e)}),i.promise}]}}).state("vicigo.hashbookNew",{url:"/u/hashbook/create",templateUrl:"/templates/blog_create.html",controller:"blogNewController"}).state("hashbook",{abstract:!0,templateUrl:"/templates/layout_blog.html",controller:"mainController"}).state("hashbook.list",{url:"/hashbook/:blogSlug",templateUrl:"/templates/blog.html",controller:"blogController"}).state("hashbook.edit",{url:"/u/hashbook/:blogSlug/edit",templateUrl:"/templates/blog_edit_simple.html",controller:"blogEditController"}).state("vicigo.hashbooks",{url:"/profile/:profileIdentifier/hashbooks",templateUrl:"/templates/blogs.html",controller:"profileBlogsController"}).state("vicigo.postByAlias",{url:"/post/:username/:alias",templateUrl:"/templates/post.html",controller:"postController",resolve:{post:["$stateParams","$rootScope","$http","MetaService","PostService",function(e,t,o,a,i){return o.get("/api/post/"+e.username+"/"+e.alias).then(function(e){return a.setForPost(e.data),e.data})}]}})}]).service("MetaService",function(){var e={title:"#vicigo",author:"Vicigo",description:"explore the world of hashtags - #vicigo makes it easy to browse the most interesting information, get your questions answered and share your own knowledge.",robots:"index, follow",keywords:"vicigo,viciqloud,hashtag,information,question,answer,social media,share,blog,post,technology",ogTitle:"#vicigo",ogSite_name:"Vicigo",ogUrl:"https://vicigo.com/",ogDescription:"explore the world of hashtags - #vicigo makes it easy to browse the most interesting information, get your questions answered and share your own knowledge.",fbAppId:0x59a7f059c1a46,ogType:"website",ogLocale:"locale",articlePublisher:"https://www.facebook.com/vvicigo",ogImage:"https://www.vicigo.com/img/fb_post.png",twitterTitle:"#vicigo",twitterUrl:"https://www.vicigo.com/",twitterDescription:"explore the world of hashtags"},t=e,o=function(e,o){t[e]=o};return{setDefault:function(){return t=e,!0},setForPost:function(t){o("author",t.author_name);var a=t.hashtags.map(function(e){return e.hashtag}).join(", ");return 4==t.post_type_id||5==t.post_type_id?(o("title","Image on Vicigo by @"+t.author_name+" | Vicigo"),o("ogTitle","Image on Vicigo by @"+t.author_name),o("twitterTitle","Image on Vicigo by @"+t.author_name),o("ogUrl","https://vicigo.com/post/"+t.post_id),o("description",a),o("keywords",a),o("ogDescription",a),o("twitterDescription",a)):(o("title",t.post_title+" by @"+t.author_name+" |  Vicigo"),o("ogTitle",t.post_title+" by @"+t.author_name),o("twitterTitle",t.post_title+" by @"+t.author_name),o("description",a),o("keywords",a),o("ogDescription",a),o("twitterDescription",a)),o("ogImage",t.post_image_url?t.post_image_url:e.ogImage),!0},setForHashtag:function(a){t=e;var i="#"+a+" | Vicigo photos and articles",s="Photos, posts and articles with the hashtag '"+a+"' on Vicigo.";return o("ogUrl","https://vicigo.com/hashtag/"+a),o("title",i),o("ogTitle",i),o("twitterTitle",i),o("description",s),o("keywords",s),o("ogDescription",s),o("twitterDescription",s),!0},setForProfile:function(a){t=e;var i=a.hashtags.map(function(e){return e.hashtag}).join(", "),s="@"+a.name;s+=a.title?", "+a.title:"",s+="  | Vicigo";var n="The newest photos and articles from @"+a.name+".";return n+=a.title?" "+a.title:"",n+=" "+i,o("title",s),o("ogTitle",s),o("twitterTitle",s),o("ogUrl","https://vicigo.com/profile/"+a.user_id),o("description",n),o("keywords",i),o("ogDescription",n),o("twitterDescription",n),!0},display:function(e){return t[e]}}}).service("Uploader",["$http","ViciAuth",function(e,t){var o={IMAGE:"/upload/image"},a=function(e){document.getElementById("imageUploadProgressBar").setAttribute("aria-valuenow",e),document.getElementById("imageUploadProgressBar").style.width=e+"%"},i=function(){imageDropzone=new Dropzone("body",{url:o.IMAGE,maxFiles:10,thumbnailWidth:null,previewTemplate:document.querySelector("#preview-template").innerHTML,clickable:"#imageDropzone"}).on("addedfile",function(e){$("#uploadImageModal").modal("show"),$("#uploadedImage").attr("src",null),$(".tags-area").tagit("removeAll"),$(".dz-message").removeClass("hidden"),$("#uploadedImage").addClass("hidden")}).on("sending",function(e,o){a(0),$("#imageUploadProgress").removeClass("hidden"),o.setRequestHeader("X-Auth-Token",t.getAuthToken())}).on("uploadprogress",function(e,t){a(t)}).on("success",function(e,t){a(100),setTimeout(function(){$("#imageUploadProgress").addClass("hidden")},500),document.getElementById("uploadedImage").src=t.link,$("#uploadedImagePostId").val(t.postId),document.getElementById("publishPicturePostBtn").disabled=!1,$(".dz-message").addClass("hidden"),$("#uploadedImage").removeClass("hidden")})};return{init:i}}]).service("CommentService",["$http",function(e){var t=function(t,o){e.delete("/api/post/"+t+"/comments/"+o).then(function(e){})},o=function(t,o){e.get("/api/post/"+t+"/comments").then(function(e){o(e.data)})},a=function(t,o,a){if(t&&o){var i={postId:t,body:o};e.post("/api/post/"+t+"/comments/",i).then(function(e){a(e.data)})}};return{postComment:a,getComments:o,deleteComment:t}}]).service("HashbookService",["$http","API_URL",function(e,t){var o=function(o,a,i){e({url:t+"/api/profile/"+o+"/hashbooks",method:"GET",params:a}).then(function(e){i(e.data)})};return{getHashbooks:o}}]).service("RelsService",["$http","API_URL",function(e,t){var o=function(o){e.post(t+"/api/profile/"+o+"/follow/").then(function(e){})},a=function(o){e.post(t+"/api/profile/"+o+"/unfollow/").then(function(e){})},i=function(o,a){e.get(t+"/api/profile/"+o+"/followers").then(function(e){a(e.data)})},s=function(o,a){e.get(t+"/api/profile/"+o+"/following").then(function(e){a(e.data)})},n=function(o){e.get(t+"/api/hashtag/"+o+"/follow").then(function(e){})},r=function(o){e.get(t+"/api/hashtag/"+o+"/unfollow").then(function(e){})},l=function(o,a){e.get(t+"/api/profile/"+o+"/hashtags/following").then(function(e){a(e.data)})};return{followHashtag:n,unfollowHashtag:r,followProfile:o,unfollowProfile:a,showFollowing:s,showFollowers:i,showFollowedHashtags:l}}]).service("PostService",["$http","$sce","API_URL",function(e,t,o){var a=function(t){return e.delete(o+"/api/post/"+t)},i=function(t,a){return e.get(o+"/api/post/"+t).then(function(e){a(e.data)})},s=function(t,a,i){return e.get(o+"/api/post/"+t+"/"+a).then(function(e){i(e.data)})},n=function(e){return t.trustAsHtml(e)},r=function(t,a,i){e.put(o+"/api/post/image/publish",{postId:t,tags:a.hashtags}).then(function(e){i(e.data)})},l=function(t){e.post(o+"/api/post/"+t+"/upvote").then(function(e){})},c=function(t){e.post(o+"/api/post/"+t+"/downvote").then(function(e){})},u=function(t,a){e.get(o+"/api/post/"+t+"/upvotes").then(function(e){a(e.data)})},d=function(t,a){e.get(o+"/api/post/"+t+"/views").then(function(e){a(e.data)})};return{getViews:d,getUpvotes:u,publishPic:r,getById:i,getByAlias:s,removePost:a,upvote:l,downvote:c,displayHTML:n}}]).service("FeedService",["$http","API_URL",function(e,t){var o=function(o,a){e({url:t+"/api/feeds",method:"GET",params:{hashtag:o.hashtag,sort:o.sort,filter:o.filter,page:o.page?o.page:1,profileId:o.profileId,algorithm:o.algorithm}}).then(function(e){a(e.data)})};return{fetchFeeds:o}}]).factory("AuthInterceptor",["$rootScope","$q",function(e,t){return void 0==e.activeCalls&&(e.activeCalls=0),{request:function(t){return e.activeCalls+=1,t},requestError:function(o){return e.activeCalls-=1,t.reject(o)},response:function(t){return e.activeCalls-=1,t},responseError:function(o){return e.activeCalls-=1,400==o.status&&o.data&&"POST_TOO_SHORT"==o.data.code&&toastr.info("Post is too short. The minimal amount of charackters is 300. Current: "+o.data.textLength),401==o.status&&e.$broadcast("notAuthenticated"),t.reject(o)}}}]).controller("appController",["$scope","ViciAuth","PostService",function(e,t,o){e.AUTH_TOKEN=t.getAuthToken()}]).controller("welcomeController",["$rootScope","$scope","$location","$state","$http","ViciAuth",function(e,t,o,a,i,s){if(t.message="",o.search().code)switch(o.search().code){case"WRONG_PASSWORD":t.message="Wrong password";break;case"NO_USER_FOUND":t.message="User not found";break;case"LOG_IN_WITH_FACEBOOK":t.message="Log in with Facebook";break;default:t.message="Login error. Try again..."}e.login=function(t){s.login(t.loginemail,t.loginpassword).then(function(t){e.user={id:t.userId},a.go("vicigo.feeds")},function(e){e.err&&(e.err.code?a.go("starter.login",{code:e.err.code}):a.go("starter.login",{code:"ERROR"}))})},e.signup=function(t){if(!t.username)return alert("Username is required!");if(!t.password)return alert("Password is required!");if(!t.email)return alert("Email is required!");var o={username:t.username,password:t.password,email:t.email};s.signup(o).then(function(t){e.user={id:t.userId},a.go("vicigo.feeds")},function(e){e.err.code&&a.go("starter.login",{code:e.err.code})})},i.get("/api/hashtags/trending").then(function(e){t.hashtags=e.data.map(function(e){return e.hashtag})})}]).controller("chatController",["$rootScope","$stateParams","$scope","$state","$http","$sce",function(e,t,o,a,i,s){o.message="",o.messages=[];var n=io();alert(e.user.id),n.emit("chatJoined",{senderId:e.user.id,receiverId:t.userId}),n.on("chatMessage",function(e){o.messages.push(e)}),o.submitMessage=function(e){return n.emit("chatMessage",e),o.messages.push(e),o.message="",!1}}]).controller("blogController",["$rootScope","$stateParams","$scope","$state","$http","CommentService","PostService",function(e,t,o,a,i,s,n){o.blogSlug=t.blogSlug,o.blog={},o.followHashbook=function(t){e.user.id?i.post("/api/hashbook/"+o.blog.blog_id+"/follow?medium=vicigo&source=hashbook_page").then(function(e){o.blog.blogFollowed=!0}):bootbox.prompt("<b>What is your email?</b>",function(e){i.post("/api/hashbook/"+t.blog_id+"/follow?medium=email&source=hashbook_page",{email:e})})},i.get("/api/hashbook/"+o.blogSlug).then(function(e){o.blog=e.data}),hashbookBGDropzone=new Dropzone("#hashbookBGDropzone",{url:"/upload/image?isBackground=true&hashbookId="+o.blog.blog_id,maxFiles:1,thumbnailWidth:null,previewTemplate:document.querySelector("#preview-template").innerHTML,clickable:"#hashbookBGDropzone"}),hashbookBGDropzone.on("success",function(e,t){o.blog.bg_picture=t.link}),o.upvotePost=function(t,a){return e.user.id?(o.blog.posts[a].upvotes_count=o.blog.posts[a].upvotes_count+1,o.blog.posts[a].alreadyUpvoted=!0,void n.upvote(t)):$("#loginModal").modal()},o.showComments=function(e,t){o.feeds[t].showComments?o.feeds[t].showComments=!1:s.getComments(e,function(e){o.feeds[t].showComments=!0,o.feeds[t].comments=e})},o.postComment=function(e,t,a){o.feeds[a].commentDraft="",s.postComment(e,t,function(e){o.feeds[a].showComments=!0,o.feeds[a].comments.unshift(e)})},o.deleteComment=function(e,t,a,i){o.feeds[a].comments.splice(i,1),s.deleteComment(e,t)},o.displayPostBody=n.displayHTML}]).controller("blogEditController",["$rootScope","$stateParams","$scope","$state","$http","$sce",function(e,t,o,a,i,s){$(".tags-area").tagit(),o.blogSlug=t.blogSlug,o.blog={},i.get("/api/hashbook/"+o.blogSlug+"?fields=hashtags").then(function(e){o.blog=e.data;for(var t=o.blog._hashtags,a=0;a<t.length;a++)$(".tags-area").tagit("createTag",t[a].hashtag)}),o.updateBlog=function(e){e={title:e.blog_title,desc:e.blog_desc,hashtags:e.hashtags},i.put("/api/hashbook/"+o.blogSlug,e).then(function(e){a.go("hashbook.list",{blogSlug:o.blogSlug})},function(e){})}}]).controller("blogNewController",["$rootScope","$scope","$state","$http",function(e,t,o,a){$(".tags-area").tagit({placeholderText:"place for hashtags!"}),t.blog={slug:null,title:null,desc:null,hashtags:null,type:"blog"},t.createBlog=function(e){return!!e.title&&!!e.hashtags&&void a.post("/api/hashbook",e).then(function(e){t.data=e.data,o.go("hashbook.list",{blogSlug:t.blog.slug})})}}]).controller("importController",["$rootScope","$scope","$state","$http",function(e,t,o,a){$(".tags-area").tagit({placeholderText:"place for hashtags!"}),t.data=[],t.activePost=!1,a.get("/api/external_services/fb/fetch_photos").then(function(e){t.data=e.data}),t.selectedImageUrl="",t.tagExternalPost=function(e){$("#uploadExternalImageModal").modal("show"),t.selectedImageUrl=e.source,t.activePost=e},t.publishExternalPost=function(){var e=t.data.indexOf(t.activePost);t.data.splice(e,1),$("#uploadExternalImageModal").modal("hide");var o=$("#hashtagsForImportedPhoto").val(),i=angular.copy(t.activePost);i.tags=o,a.post("/api/post/image/from_link",i).then(function(e){$(".tags-area2").tagit("removeAll")})}}]).controller("userListCtrl",["$rootScope","$scope","$uibModalInstance","postId","statType","stats","PostService",function(e,t,o,a,i,s,n){t.stats=s,t.cancel=function(){o.dismiss("cancel")},t.showItems=function(e){t.statType=e,"upvotes"==e&&n.getUpvotes(a,function(e){t.items=e}),"views"==e&&n.getViews(a,function(e){t.items=e})},s.upvotesCount?t.showItems("upvotes"):t.showItems("views"),e.$on("$stateChangeStart",function(){t.cancel()})}]).controller("mainController",["$rootScope","$scope","$state","$sce","$window","$location","$http","ViciAuth","MetaService","PostService","$uibModal",function(e,t,o,a,i,s,n,r,l,c,u){n.get("/api/hashtags/trending").then(function(e){t.hashtags=e.data.map(function(e){return e.hashtag})}),t.showUpvotes=function(e,o){c.getUpvotes(e.id,function(a){u.open({animation:t.animationsEnabled,templateUrl:"userListModal.html",controller:"userListCtrl",resolve:{statType:o,postId:e.id,stats:function(){return{upvotesCount:e.upvotes_count,viewsCount:e.views_count,commentsCount:e.comment_count}},postUpvotes:function(){return a}}})})},e.MetaService=l,e.trustSrc=function(e){return a.trustAsResourceUrl(e)},t.goToPost=function(e){o.go("vicigo.post",{postId:e.id})},e.fbLogin=function(t){r.fbAuth(function(t){$("#loginModal").modal("hide"),e.user={id:t.userId},o.go("vicigo.feeds")})},e.searchVicigo=function(e){return e=e.toLowerCase(),e=e.replace("#",""),e=e.replace("@",""),n.get("/api/search?q="+e).then(function(e){return e.data.map(function(e){return e})})},e.searchResultSelected=function(e){switch(e.type){case"profile":o.go("vicigo.profile",{profileId:e.objId});break;case"post":o.go("vicigo.post",{postId:e.objId});break;case"hashtag":o.go("vicigo.hashtag",{hashtag:e.objId})}},t.sort=function(e){e==t.sortType?i.location.reload():(t.sortType=e,t.postsAvailable=!0,s.search("sort",t.sortType))},t.newPhoto=function(){$("#uploadImageModal").modal("show"),$("#uploadedImage").attr("src",null),$(".tags-area").tagit("removeAll"),$(".dz-message").removeClass("hidden"),$("#uploadedImage").addClass("hidden")},t.editPhoto=function(e){$("#uploadImageModal").modal("show"),$("#uploadedImage").attr("src",e.image_url),$(".dz-message").addClass("hidden"),$("#uploadedImage").removeClass("hidden"),document.getElementById("publishPicturePostBtn").disabled=!1,$(".tags-area").tagit("removeAll"),e.hashtags=e.hashtags?e.hashtags:[];for(var t=0;t<e.hashtags.length;t++)$(".tags-area").tagit("createTag",e.hashtags[t].hashtag);$("#uploadedImagePostId").val(e.id),imageDropzone.removeAllFiles(!0)},t.displayFeedBody=c.displayHTML,t.getFeedLink=function(e){return"/post/"+e.id},t.hasTitle=function(e){return 4!=e},e.publishPicturePost=function(){var e=$("#uploadedImagePostId").val(),t=$("#uploadedPictureTags").val();$("#uploadImageModal").modal("toggle"),e&&c.publishPic(e,{hashtags:t},function(){$(".dz-message").removeClass("hidden"),$("#uploadedImage").attr("src",""),$("#uploadedPictureTags").tagit("removeAll"),document.getElementById("publishPicturePostBtn").disabled=!0,$(".dz-message").removeClass("hidden"),$("#uploadedImage").addClass("hidden")})},e.logoutMe=function(){r.logout(),n.get("/api/me/logout").then(function(t){e.user=!1,e.fetchingNotifs=!1,o.go("starter.welcome")})}}]).controller("postController",["$rootScope","$stateParams","$http","$scope","$sce","post","RelsService","CommentService",function(e,t,o,a,i,s,n,r){a.postId=s.post_id,a.post=s,a.comments=[],a.follow=function(t){return e.user.id?(a.post.authorFollowed=!0,void n.followProfile(t)):$("#loginModal").modal()},r.getComments(a.postId,function(e){a.comments=e}),a.postComment=function(e,t){a.commentDraft="",r.postComment(e,t,function(e){a.comments.unshift(e)})},a.deleteComment=function(e,t,o){a.comments.splice(o,1),r.deleteComment(e,t)},a.openShareModal=function(e,t,o){bootbox.confirm("Are you sure?",function(e){e&&(isDraft?a.drafts.splice($index,1):a.feeds.splice($index,1),PostService.removePost(feed.id))})}}]).controller("profileBlogsController",["$scope","$stateParams","$http","HashbookService",function(e,t,o,a){e.blogs=[],e.profileIdentifier=t.profileIdentifier,a.getHashbooks(e.profileIdentifier,{},function(t){e.blogs=t}),e.deleteHashbook=function(t,a,i){bootbox.prompt("Do you really want to delete this Hashbook? You will not be able to revoke it. Write <b>'"+a.toUpperCase()+"'</b> to confirm.",function(t){t&&t.toUpperCase()==a.toUpperCase()&&bootbox.confirm("Do you really really want irrevocablly to delete it? Sure? Second thoughts?",function(t){return t?(o.delete("/api/hashbook/"+a),e.blogs.splice(i,1)):void 0})})}}]).service("ProfileService",["$http","API_URL",function(e,t){var o=function(o,a){e.get(t+"/api/profile/"+o).then(function(e){a(e.data)})},a=function(o,a){e({url:t+"/api/profile/status",method:"GET",params:{}}).then(function(e){a(e.data)})},i=function(o,a,i){e({url:t+"/api/profile/"+o+"/recommented/accounts",method:"GET",params:a}).then(function(e){i(e.data)})};return{fetchProfileStatus:a,fetchProfile:o,fetchRecommentedProfiles:i}}]).controller("discoverController",["$rootScope","$stateParams","$scope","ProfileService",function(e,t,o,a){a.fetchRecommentedProfiles(t.profileId,{},function(e){})}]).controller("profileController",["$rootScope","$stateParams","$scope","$sce","$window","$location","$http","$q","FeedService","CommentService","ProfileService","RelsService","HashbookService","PostService","profile",function(e,t,o,a,i,s,n,r,l,c,u,d,p,f,h){o.filter=function(e){e==o.filterType?o.filterType=null:o.filterType=e,o.postsAvailable=!0,s.search("filter",o.filterType),o.page=1,o.feeds=[],o.fetchFeeds()},$(".tags-area").tagit({placeholderText:"place for hashtags!"}),o.profile=h,o.profileId=o.profile.user_id,o.hashtag=s.search().hashtag?s.search().hashtag:null,o.page=1,o.feeds=[],o.followGuys=[],o.showProfileTab="feeds",o.limit=10,o.postsAvailable=!0,e.isLoading=!0,o.drafts=[],o.followedHashtags=[],n.get("/api/profile/"+o.profileId+"/drafts?post_type_id=5").then(function(e){o.drafts=e.data}),o.fetchPost=function(e,t){n.get("/api/post/"+e).then(function(e){o.feeds[t].body=e.data.post_body,o.feeds[t].isFull=!0})},p.getHashbooks(o.profileId,{limit:4},function(e){o.hashbooks=e}),d.showFollowedHashtags(o.profileId,function(e){o.followedHashtags=e}),o.unfollowHashtag=function(e,t){d.unfollowHashtag(e),o.followedHashtags.splice(t,1)},o.feedOnScreen=function(t,a,i){e.user&&e.user.id!==o.profileId&&!o.feeds[a].seen&&i&&(o.feeds[a].seen=!0,n.post("/api/post/"+t+"/view")),o.feeds[a].comment_count&&c.getComments(o.postId,function(e){o.feeds[a].comments=e,o.feeds[a].showComments=!0})},o.updateProfileName=function(e){var t=r.defer();return n.put("/api/profile/"+o.profileId+"/username",{username:e}).success(function(e){e=e||{},"ok"===e.status?t.resolve():t.resolve(e.msg)}).error(function(e){t.reject(e)}),t.promise},o.updateProfileTitle=function(e){var t=r.defer();return n.put("/api/profile/"+o.profileId+"/title",{title:e}).then(function(e){e=e||{},"ok"===e.status?t.resolve():t.resolve(e.msg)},function(e){t.reject(e)}),t.promise},o.clickProfilePic=function(t,o){e.user&&t==o&&$("#uploadProfilePicModal").appendTo("body").modal("show")},o.fetchFeeds=function(e){e=e?e:{},e&&void 0!==e.hashtag?(o.hashtag=e.hashtag,s.search("hashtag",o.hashtag)):o.hashtag?e.hashtag=o.hashtag:s.search("hashtag",null),o.filterType?e.filter=o.filter:s.search("filter",null),o.showProfileTab="feeds",l.fetchFeeds({filter:e.filter,hashtag:e?e.hashtag:null,page:e.page?e.page:o.page,filter:o.filterType,algorithm:"none",profileId:o.profileId},function(t){t&&(0===e.page?o.feeds=t:t.forEach(function(e){o.feeds.push(e)}),t.length<o.limit?o.postsAvailable=!1:o.postsAvailable=!0)})},o.fetchFeeds({}),o.showFeeds=function(e){o.hashtag=null,o.showProfileTab="feeds"},o.showHashtags=function(){o.showProfileTab="hashtags"},o.follow=function(t){return e.user.id?(o.profile.alreadyFollowing=!0,void d.followProfile(t)):$("#loginModal").modal()},o.unfollow=function(e){o.profile.alreadyFollowing=!1,d.unfollowProfile(e)},o.showFollowers=function(e){o.showProfileTab="followers",d.showFollowers(o.profileId,function(e){o.followGuys=e})},o.showFollowing=function(e){o.showProfileTab="following",d.showFollowing(o.profileId,function(e){o.followGuys=e})},o.upvote=function(t,a){return e.user.id?(o.feeds[a].upvotes_count=o.feeds[a].upvotes_count+1,o.feeds[a].alreadyUpvoted=!0,void f.upvote(t)):$("#loginModal").modal()},o.showComments=function(e,t){o.feeds[t].showComments?o.feeds[t].showComments=!1:c.getComments(o.postId,function(e){o.feeds[t].comments=e,o.feeds[t].showComments=!0})},o.postComment=function(e,t,a){var i={};i.postId=e,i.body=t,o.feeds[a].showComments=!0,o.feeds[a].commentDraft="",c.postComment(e,t,function(e){o.feeds[a].comments?o.feeds[a].comments.unshift(e):o.feeds[a].comments=[e]})},o.deleteComment=function(e,t,a,i){o.feeds[a].comments.splice(i,1),c.deleteComment(e,t)},o.removePost=function(e,t,a){bootbox.confirm("Are you sure?",function(i){i&&(t?o.drafts.splice(a,1):o.feeds.splice(a,1),f.removePost(e.id))})},o.loadMore=function(){!e.activeCalls&&o.postsAvailable&&(o.page=o.page+1,o.fetchFeeds({page:o.page}))}}]).controller("editorController",["$rootScope","$state","$scope","$stateParams","$http","$timeout","ViciAuth",function(e,t,o,a,i,s,n){o.draft={},o.Saving={body:!1,title:!1},o.publishPost=function(e){i.put("/api/draft/"+e+"/publish").then(function(o){return 400==o.status&&"POST_TOO_SHORT"==o.data.code?toastr.info("Your story is too short. The minimum number of characters is 300."):(200==o.status&&(toastr.success("You have successfully published your story."),s(function(){t.go("vicigo.post",{postId:e})},1500)),toastr.warning(JSON.stringify(o.data)))})},o.ready=!1;var r=function(e){e||alert("Editor cannot be initialized"),$("#description").tagit({afterTagAdded:function(e,t){o.ready&&o.saveDraftElement("hashtags")}}),o.draft.hashtags.forEach(function(e){$("#description").tagit("createTag",e.hashtag)}),$("#title").froalaEditor({key:"krlenofG5hcj1==",toolbarInline:!0,charCounterMax:50,countCharacters:!0,alwaysVisible:!1,buttons:[],allowComments:!1,allowScript:!1,allowStyle:!1,plainPaste:!0,allowedAttrs:[],placeholderText:"Title"}),$("#body").froalaEditor({key:"krlenofG5hcj1==",imageUploadURL:"/upload/image?postId="+e,heightMin:260,imageDefaultWidth:640,imagePaste:!1,toolbarButtons:["bold","italic","underline","insertLink","insertImage","insertVideo","quote","insertHR","html"],requestHeaders:{"X-Auth-Token":n.getAuthToken()},placeholder:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."}),$("#body").froalaEditor("html.set",o.draft.post_body?o.draft.post_body:""),$("#body").on("froalaEditor.contentChanged",function(e,t){o.Saving.body&&clearTimeout(o.Saving.body),o.Saving.body=setTimeout(function(){o.saveDraftElement("body")},1500)}),$("#title").froalaEditor("html.set",o.draft.post_title?o.draft.post_title:""),$("#title").on("froalaEditor.contentChanged",function(e,t){o.Saving.title&&clearTimeout(o.Saving.title),o.Saving.title=setTimeout(function(){o.saveDraftElement("title")},1500)}),new Dropzone("#backgroundImageDropzone",{url:"/upload/image?isBackground=true&postId="+e,maxFiles:10,thumbnailWidth:null,previewTemplate:document.querySelector("#preview-template").innerHTML,clickable:"#uploadPostBackground"}).on("sending",function(e,t){t.setRequestHeader("X-Auth-Token",n.getAuthToken())}).on("success",function(e,t){o.draft.post_image_url=t.link}),o.ready=!0};o.draft={},a.postId?i.get("/api/post/"+a.postId).then(function(e){o.draft=e.data,r(o.draft.post_id)}):i.get("/api/draft").then(function(e){o.draft=e.data,r(o.draft.post_id)}),o.saveDraftElement=function(e){var t={};return t.title=$("#title").froalaEditor("html.get")?$("#title").froalaEditor("html.get"):null,t.body=$("#body").froalaEditor("html.get")?$("#body").froalaEditor("html.get"):null,t.hashtags=$("input#description").val(),t.body||t.title||t.hashtags?void i.put("/api/draft/"+o.draft.post_id+"/"+e,t).then(function(e){return o.saving=null,toastr.success("Draft has been saved.")}):(o.saving=null,!1)},o.saveDraft=function(e){var t={};t.title=$("#title").froalaEditor("html.get")?$("#title").froalaEditor("html.get"):"",t.hashtags=$("#description").val()?$("#description").val():"",t.body=$("#body").froalaEditor("html.get")?$("#body").froalaEditor("html.get"):"";var o=e;i.post("/api/draft/"+o,t).then(function(e){toastr.success("Draft has been saved.")})}}]).controller("notifsController",["$rootScope","$scope","notifs","$http",function(e,t,o,a){t.notifs=o,t.page=1,t.limit=30,e.isLoading=!0,t.postsAvailable=!0,t.markAllNotifsAsRead=function(){a.put("/api/notifications/read_all"),e.userStatus&&(e.userStatus.notifications_count=0),t.notifs=t.notifs.map(function(e){return e.status=1,e})},t.markNotifAsRead=function(e,o){if(0==e.status)return t.notifs[o].status=1,a.put("/api/notifications/read_one/"+e.event_id)},t.fetchNotifs=function(e,o){a.get("/api/notifications?page="+e+"&limit="+o).then(function(e){e.data.forEach(function(e){t.notifs.push(e)}),e.data.length<t.limit?t.postsAvailable=!1:t.postsAvailable=!0})},t.loadMoreNotifs=function(){!e.activeCalls&&t.postsAvailable&&(t.page=t.page+1,t.fetchNotifs(t.page,t.limit))},t.displayPost=function(e){return 2==e.event_type&&4==e.post_type_id?"pic":2!=e.event_type||3!=e.post_type_id&&2!=e.post_type_id?"post":'post "'+e.post_title+'"'}}]).controller("feedsController",["$rootScope","$scope","$stateParams","$location","$http","FeedService","CommentService","PostService",function(e,t,o,a,i,s,n,r){t.filter=function(e){e==t.filterType?t.filterType=null:t.filterType=e,t.postsAvailable=!0,a.search("filter",t.filterType),t.page=1,t.feeds=[],t.fetchFeeds()},$(".tags-area").tagit({placeholderText:"place for hashtags!"}),t.feedOnScreen=function(e,o,a,s){!t.feeds[o].seen&&a&&(t.feeds[o].seen=!0,i.post("/api/post/"+e+"/view")),t.feeds[o].comment_count&&i.get("/api/post/"+e+"/comments/").then(function(e){t.feeds[o].comments=e.data,t.feeds[o].showComments=!0})},t.feeds=[],t.page=1,t.limit=10,e.isLoading=!0,t.postsAvailable=!0,t.hashtagFollowed=!1,t.hashtag=o.hashtag,t.hashtag&&i.get("/api/hashtag/"+t.hashtag).then(function(e){t.hashtagInfo=e.data}),t.sortType="new",t.filterType=a.search().filter?a.search().filter:null,t.recommendedHashtags=[],t.recommendedProfiles=[],t.fetchPost=function(e,o){i.get("/api/post/"+e).then(function(e){t.feeds[o].body=e.data.post_body,t.feeds[o].isFull=!0})},t.removePost=function(e,o,a){bootbox.confirm("Are you sure?",function(i){if(i)return r.removePost(e.id),o?t.drafts.splice(a,1):t.feeds.splice(a,1)})},t.fetchFeeds=function(){s.fetchFeeds({page:t.page,hashtag:t.hashtag,filter:t.filterType,algorithm:t.hashtag?"none":"feeds"},function(e){e?(e.forEach(function(e){
t.feeds.push(e)}),e.length<t.limit?t.postsAvailable=!1:t.postsAvailable=!0):t.postsAvailable=!1})},t.fetchFeeds(),t.loadMore=function(){!e.activeCalls&&t.postsAvailable&&(t.page=t.page+1,t.fetchFeeds())},t.upvote=function(o,a){return e.user.id?(t.feeds[a].alreadyUpvoted=!0,t.feeds[a].upvotes_count=t.feeds[a].upvotes_count+1,void r.upvote(o)):$("#loginModal").modal()},t.showComments=function(e,o){t.feeds[o].showComments?t.feeds[o].showComments=!1:(t.feeds[o].showComments=!0,i.get("/api/post/"+e+"/comments/").then(function(e){t.feeds[o].comments=e.data}))},t.postComment=function(e,o,a){t.feeds[a].commentDraft="",n.postComment(e,o,function(e){t.feeds[a].comments?t.feeds[a].comments.unshift(e):t.feeds[a].comments=[e]})},t.deleteComment=function(e,o,a,i){t.feeds[a].comments.splice(i,1),n.deleteComment(e,o)},t.hashtagFollowed=!0,o.hashtag&&e.user&&i.get("/api/hashtag/"+o.hashtag+"/follow").then(function(e){t.hashtagFollowed=e.data.isFollowing}),t.followHashtag=function(o,a,s){return e.user.id?(void 0!==a?t.recommendedHashtags.splice(a,1):t.hashtagFollowed=!0,void i.post("/api/hashtag/follow",{hashtag:o})):$("#loginModal").modal()},t.unfollowHashtag=function(e){t.hashtagFollowed=!1,i.post("/api/hashtag/unfollow",{hashtag:e})}}]).controller("draftsController",["$scope","$stateParams","$http",function(e,t,o){e.drafts=[],o.get("/api/drafts").then(function(t){e.drafts=t.data})}]).run(["$rootScope","$state","ViciAuth",function(e,t,o){e.$on("$stateChangeStart",function(a,i,s,n){"starter.welcome"==i.name?e.welcome=!0:e.welcome=!1,"starter.login"==i.name||"starter.signup"==i.name||"blog"==i.name?e.noHeader=!0:e.noHeader=!1,o.validate(function(o){if(o&&o.userId){var a={id:o.userId,profileImageUrl:o.profileImageUrl,name:o.name};e.user=a}else e.user=!1,"vicigo.feeds"==i.name&&t.go("starter.welcome")})})}]).directive("backImg",function(){return function(e,t,o){var a=o.backImg;t.css({"background-image":"url("+a+")","background-size":"cover"})}}).directive("fallbackSrc",function(){var e={link:function(e,t,o){t.bind("error",function(){angular.element(this).attr("src",o.fallbackSrc)})}};return e}).directive("feed",function(){return{templateUrl:"/templates/directives/feed.html"}}).directive("postHeader",function(){return{templateUrl:"/templates/directives/postHeader.html"}});